<html>
<head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3FQ9B7C4R9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-3FQ9B7C4R9');
</script>

<!-- Amplitude Browser SDK v2 -->
<script src="amplitude/analytics-browser-2.11.0-min.js" defer></script>
<!-- （任意）セッションリプレイを使うならここも置く。読めなければ無視してOK -->
<script src="amplitude/session-replay-browser-1.10.0-min.js" defer></script>

<script>
  // Unity からの同期呼び出し用キュー
  window.__amp = { ready: false, error: false, amp: null, q: [] };
  window.__ampCall = f => window.__amp.ready ? f(window.__amp.amp) : window.__amp.q.push(f);

  (function boot() {
    if (!window.amplitude) { setTimeout(boot, 20); return; }
    const amp = window.amplitude;

    // 読めていれば追加（UMD or ESMバンドル両対応）
    const replayPluginFactory =
      (window.sessionReplay && window.sessionReplay.plugin) || window.sessionReplayPlugin;
    if (replayPluginFactory) {
      amp.add(replayPluginFactory({ sampleRate: 1 }));
    }

    try {
      // 同期的に init（Promise 前提にしない）
      amp.init("b1bad87395faa2bc78f410f21d3b6381", {
        defaultTracking: { pageViews: true, sessions: true }
      });

      // ここで準備完了にしてOK（UMD直読みではこれで動く）
      window.__amp.amp = amp;
      window.__amp.ready = true;

      // 動作確認用に1発送る
      amp.track("Ping", { source: "html", env: "local", t: Date.now() });

      // Unity 側から貯まっていた呼び出しを流す
      const q = window.__amp.q.splice(0);
      q.forEach(fn => fn(amp));

    } catch (e) {
      console.error('[Amplitude] init error', e);
      window.__amp.error = true;
    }
  })();
</script>

</head>
<body>
<p>Hello!</p>
</body>
</html>